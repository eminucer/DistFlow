%% Baran & Wu 32 Bus Test Distribution Grid (1989)
% This distribution grid is based on the following paper.
% M. E. Baran and F. F. Wu, "Network reconfiguration in distribution systems for loss reduction and load balancing,"
% Grid parameters are described below

% pN and qN are node active and reactive powers in Watts
% rk and xk are line resistances and reactances in Ohms
% Vo is the substation voltage in Volts

% BranchTable describes which node is connected to which node
% Substation node is represented by node 0 and its voltage is constant (Vo)

Grid.pN = 1e3*[100;90;120;60;60;200;200;60;60;45;60;60;120;60;60;60;90;90;90;90;90;90;420;420;60;60;60;120;200;150;210;60];
Grid.qN = 1e3*[60;40;80;30;20;100;100;20;20;30;35;35;80;10;20;20;40;40;40;40;40;50;200;200;25;25;20;70;600;70;100;40];
Grid.rk = [0.0922;0.4930;0.3660;0.38110;0.8190;0.1872;0.7114;1.0300;1.0440;0.1966;0.3744;1.4680;0.5416;0.5910;0.7463;1.2890;0.7320;0.1640;1.5042;0.4095;0.7089;0.4512;0.8980;0.8960;0.2030;0.2842;1.0590;0.8042;0.5075;0.9744;0.3105;0.3410];
Grid.xk = [0.0470;0.2511;0.1864;0.1941;0.7070;0.6188;0.2351;0.7400;0.7400;0.0650;0.1238;1.1550;0.7129;0.5260;0.5450;1.7210;0.5740;0.1565;1.3554;0.4784;0.9373;0.3083;0.7091;0.7011;0.1034;0.1447;0.9337;0.7006;0.2585;0.9630;0.3619;0.5302];
Grid.Vo = 12660;

BranchTable = [1 0; ...
               2 1; ...
               3 2; ...
               4 3; ...
               5 4; ...
               6 5; ...
               7 6; ...
               8 7; ...
               9 8; ...
               10 9; ...
               11 10; ...
               12 11; ...
               13 12; ...
               14 13; ...
               15 14; ...
               16 15; ...
               17 16; ...
               18 1; ...
               19 18; ...
               20 19; ...
               21 20; ...
               22 2; ...
               23 22; ...
               24 23; ...
               25 5; ...
               26 25; ...
               27 26; ...
               28 27; ...
               29 28; ...
               30 29; ...
               31 30; ...
               32 31];

%% Construct the grid              
NumOfLines = length(BranchTable);
Grid.N = NumOfLines;
Grid.L = eye(NumOfLines);

for node=2:NumOfLines
    BrNode = BranchTable(node,1);
    RcNode = BranchTable(node,2);
    Grid.L(BrNode,RcNode) = 1;
end

Grid.L = abs(inv(Grid.L));

%% Solve the grid

%Grid = load('Grid Data\BaranGrid.mat');
%Grid = load('Grid Data\KekatosGrid.mat');
%Grid = load('Grid Data\TwoNodeGrid.mat');
%Grid = load('Grid Data\FiveNodeGrid.mat');
%Grid = load('Grid Data\FourNodeGrid.mat');

y = SolveDistFlow(Grid,1,10,0.0001);
